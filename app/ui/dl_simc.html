<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Dragalia Lost Damage Simulator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" type="image/png" href="/ui/favicon.png" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"
        integrity="sha512-rmZcZsyhe0/MAjquhTgiUcb4d9knaFc7b5xAfju483gbEXTkeJRUMIPk6s3ySZMYUHEcjKbjLjyddGWMrNEvZg=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"
        integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css"
        integrity="sha512-/zs32ZEJh+/EO2N1b0PEdoA10JkdC3zJ8L5FTiQu82LR9S/rOQNfQN7U59U9BC12swNeRAz3HSzIL2vpp4fv3w=="
        crossorigin="anonymous" />
    <script src="/ui/dl_simc.js" type="text/javascript"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-159918955-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-159918955-2');
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="dl_simc.css">
</head>

<body>
    <form id="test-params" method="POST">
        <div class="form-group">
            <div class="form-row">
                <div class="col-sm">
                    <label for="input-adv">Adventurer</label><select id="input-adv" class="form-control"></select>
                </div>
                <div class="col-sm" id="input-variant-group">
                    <label for="input-variant">Variant</label><select id="input-variant" class="form-control"></select>
                </div>
                <div class="col-sm">
                    <label for="input-equip">Setup</label><select id="input-equip" class="form-control">
                        <option id="equip-base" value="base">Personal DPS</option>
                        <option id="equip-buffer" value="buffer">Team Buff</option>
                        <option id="equip-affliction" value="affliction">Affliction</option>
                    </select>
                </div>
                <div class="col-sm">
                    <label for="input-teamdps">Team DPS</label><input id="input-teamdps" class="form-control"
                        type="number" step="5000" min="0" />
                </div>
                <div class="col-sm">
                    <label for="input-t">Simulation Time (s)</label><input id="input-t" class="form-control"
                        type="text" />
                </div>
                <div class="col-sm">
                    <label for="input-hp">HP</label><input id="input-hp" class="form-control" type="text" />
                </div>
            </div>
            <div class="collapse" id="basic-inputs">
                <div class="form-row">
                    <div class="col-sm-3">
                        <label for="input-wep">Weapon</label><select id="input-wep" class="form-control"></select>
                    </div>
                    <div class="col-sm-3">
                        <label for="input-dra">Dragon</label><select id="input-dra" class="form-control"></select>
                    </div>
                    <div class="col-sm-3">
                        <label for="input-ss3">Skill 3</label><select id="input-ss3" class="form-control"></select>
                    </div>
                    <div class="col-sm-3">
                        <label for="input-ss4">Skill 4</label><select id="input-ss4" class="form-control"></select>
                    </div>
                </div>
                <div class="form-row input-wp">
                    <div class="col-sm">
                        <label for="input-wp1">Wyrmprint 1</label><select id="input-wp1" class="form-control"></select>
                    </div>
                    <div class="col-sm">
                        <label for="input-wp2">Wyrmprint 2</label><select id="input-wp2" class="form-control"></select>
                    </div>
                    <div class="col-sm">
                        <label for="input-wp3">Wyrmprint 3</label><select id="input-wp3" class="form-control"></select>
                    </div>
                    <div class="col-sm">
                        <label for="input-wp4">Wyrmprint 4</label><select id="input-wp4" class="form-control"></select>
                    </div>
                    <div class="col-sm">
                        <label for="input-wp5">Wyrmprint 5</label><select id="input-wp5" class="form-control"></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="col-sm-4">
                        <label for="input-acl">ACL</label>
                        &nbsp;
                        <div class="custom-control custom-checkbox custom-control-inline">
                            <input id="input-edit-acl" class="custom-control-input" type="checkbox" />
                            <label for="input-edit-acl" class="custom-control-label">Edit</label>
                        </div>
                        <textarea id="input-acl" class="form-control" disabled></textarea>
                    </div>
                    <div class="col-sm-8">
                        <label class="coab-label">Co-Abilities:</label>
                        <br />
                        <div id="input-coabs">
                            <div id="input-coabs-blade"></div>
                            <div id="input-coabs-wand"></div>
                            <div id="input-coabs-dagger"></div>
                            <div id="input-coabs-bow"></div>
                            <div id="input-coabs-axe"></div>
                            <div id="input-coabs-lance"></div>
                            <div id="input-coabs-staff"></div>
                            <div id="input-coabs-gun"></div>
                            <div id="input-coabs-sword"></div>
                            <div id="input-coabs-other"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="collapse" id="advanced-inputs">
                <div class="form-row" id="affliction-sim">
                    <div class="col-sm col-4">
                        <label for="input-sim-poison">Poison (%)</label><input id="input-sim-poison"
                            class="form-control" type="text" placeholder="0" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-paralysis">Paralysis (%)</label><input id="input-sim-paralysis"
                            class="form-control" type="text" placeholder="0" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-burn">Burn (%)</label><input id="input-sim-burn" class="form-control"
                            type="text" placeholder="0" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-frostbite">Frostbite (%)</label><input id="input-sim-frostbite"
                            class="form-control" type="text" placeholder="0" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="col-sm col-4">
                        <label for="input-sim-buff-str">+Str%</label><input id="input-sim-buff-str_buff"
                            class="form-control" type="text" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-buff-critr">+Crit Rate%</label><input id="input-sim-buff-critr"
                            class="form-control" type="text" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-buff-critd">+Crit Dmg%</label><input id="input-sim-buff-critd"
                            class="form-control" type="text" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-buff-def">-Def%</label><input id="input-sim-buff-def_down"
                            class="form-control" type="text" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-buff-doublebuff_interval">Doublebuff (s)</label><input
                            id="input-sim-buff-doublebuff_interval" class="form-control" type="text" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-buff-count">Buff Counts</label><input id="input-sim-buff-count"
                            class="form-control" type="text" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-sim-buff-echo">Bonus Attack</label>
                        <select id="input-sim-buff-echo" class="form-control">
                            <option value="">Off</option>
                            <option value="8000">Yukata Cassandra</option>
                        </select>
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-dragonbattle">Dragon Battle</label>
                        <select id="input-dragonbattle" class="form-control">
                            <option value="">Off</option>
                            <option value="1">On</option>
                        </select>
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-classbane">Class Bane</label>
                        <select id="input-classbane" class="form-control">
                            <option value="">None</option>
                            <option value="HDT">HDT</option>
                            <option value="therion">Therion</option>
                            <option value="thaumian">Thaumian</option>
                            <option value="physian">Physian</option>
                            <option value="demihuman">Demihuman</option>
                            <option value="demon">Demon</option>
                            <!-- <option value="undead">Undead</option>
                            <option value="human">Human</option>
                            <option value="dragon">Dragon</option> -->
                        </select>
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-dumb">Dumb</label>
                        <input id="input-dumb" class="form-control" type="text" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="col">
                        <label>Conditions</label>
                        <div id="input-conditions"></div>
                    </div>
                </div>
                <div class="form-row" id="affliction-resist">
                    <div class="col-sm col-4">
                        <label for="input-res-poison">Poison</label><input id="input-res-poison" class="form-control"
                            type="text" placeholder="0" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-paralysis">Paralysis</label><input id="input-res-paralysis"
                            class="form-control" type="text" placeholder="0" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-burn">Burn</label><input id="input-res-burn" class="form-control"
                            type="text" placeholder="0" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-frostbite">Frostbite</label><input id="input-res-frostbite"
                            class="form-control" type="text" placeholder="0" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-flashburn">Flashburn</label><input id="input-res-flashburn"
                            class="form-control" type="text" placeholder="0" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-bog">Bog</label><input id="input-res-bog" class="form-control" type="text"
                            placeholder="99" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-blind">Blind</label><input id="input-res-blind" class="form-control"
                            type="text" placeholder="99" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-stun">Stun</label><input id="input-res-stun" class="form-control"
                            type="text" placeholder="99" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-freeze">Freeze</label><input id="input-res-freeze" class="form-control"
                            type="text" placeholder="99" />
                    </div>
                    <div class="col-sm col-4">
                        <label for="input-res-sleep">Sleep</label><input id="input-res-sleep" class="form-control"
                            type="text" placeholder="99" />
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="col">
                    <button type="button" id="run-test" class="btn btn-primary">Run Test</button>
                    <button type="button" id="toggle-basic" class="btn btn-success" data-toggle="collapse"
                        data-target="#basic-inputs" aria-expanded="true" aria-controls="basic-inputs">
                        Settings
                    </button>
                    <button type="button" id="toggle-advanced" class="btn btn-info" data-toggle="collapse"
                        data-target="#advanced-inputs" aria-expanded="false" aria-controls="advanced-inputs">
                        Conditions
                    </button>
                    <!-- <button type="button" id="toggle-coab" class="btn btn-info" data-toggle="collapse" data-target="#coability" aria-expanded="false" aria-controls="coability">
                    Co-Abilities
                </button>
                <button type="button" id="toggle-advanced" class="btn btn-info" data-toggle="collapse" data-target="#conditions" aria-expanded="false" aria-controls="conditions">
                    Conditions
                </button>
                <button type="button" id="toggle-resist" class="btn btn-info" data-toggle="collapse" data-target="#affliction-resist" aria-expanded="false" aria-controls="affliction-resist">
                    Resist
                </button> -->
                    <button type="button" id="display-mode" class="btn btn-secondary"></button>
                    <button type="button" class="btn btn-dark" data-toggle="modal"
                        data-target="#damageLogBox">Log</button>
                    <button type="button" class="btn btn-dark" data-toggle="modal"
                        data-target="#simulationGraphBox">Graph</button>
                    <button type="button" id="clear-results" class="btn btn-secondary">Clear</button>
                    <button type="button" id="reset-test" class="btn btn-secondary">Reset</button>
                    <button type="button" class="btn btn-secondary" data-toggle="modal"
                        data-target="#aboutBox">About</button>
                    <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#aclBox">ACL
                        Guide</button>
                    <button type="button" class="btn btn-dark" data-toggle="modal" data-target="#commitsBox">Latest
                        Updates</button>
                    <!--<a href="https://notte.moe/a-quick-guide-to-dragalia-dps-simulator/">-->
                    <!--    <button type="button" class="btn btn-dark">Usage Guide</button>-->
                    <!--</a>-->
                </div>
            </div>
        </div>
        <div class="modal fade" id="aboutBox" tabindex="-1" role="dialog" aria-labelledby="aboutTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="aboutTitle">About/FAQ</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h5>What is this?</h5>
                        <p>This is an elaborate napkin math machine, designed to estimate highest possible damage
                            per
                            second for a given adventurer.
                            The source code can be found here: <a
                                href="https://github.com/dl-stuff/dl">https://github.com/dl-stuff/dl</a></p>
                        <h5>How does simulated afflictions work?</h5>
                        <p>The affliction is considered [uptime]% effective for the entire duration of the
                            simulation.
                        </p>
                        <h5>How does simulated buff/debuff work?</h5>
                        <p>1 stack of the entered buff/debuff is active for the entire duration of the simulation.
                        </p>
                        <h5>Why does the result show a different wyrmprint than my inputs?</h5>
                        <p>Wyrmprints with the same ability are automatically swapped for the best option in terms
                            of
                            stats and value, as long as any affinities are preserved.</p>
                        <h5>What does the damage graph display?</h5>
                        <p>For personal damage, the average DPS of a ±5s window is calculated around each time
                            point.
                            For team DPS, each point represents a time where the team DPS % changes.</p>
                        <h5>How are the setups (Personal/Team/Affliction) created?</h5>
                        <p>Whenever a simulation is ran, the server will compare the result with the highest
                            recorded
                            DPS/Team DPS, and store the setup if it is better.
                            For personal/affliction, team DPS is not considered. Likewise for team DPS, only the
                            team
                            buff % is considered.
                            Since these setups are crowdsourced, no guarentee is made on any one of them being
                            optimal
                            and you are encouraged to try for bigger numbers.
                        </p>
                        <h5>I need to speak to the manager.</h5>
                        <p><a href="https://github.com/dl-stuff/dl/issues">Open an issue here</a>, or ask me on
                            discord
                            I'm chu2.718281828459045235360287471#0110</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="damageLogBox" tabindex="-1" role="dialog" aria-labelledby="damageLogTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="damageLogTitle">Damage Logs</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <pre id="damage-log"></pre>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="simulationGraphBox" tabindex="-1" role="dialog"
            aria-labelledby="simulationGraphTitle" aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="simulationGraphTitle">Simulation Graphs</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <canvas id="damage-graph" width="800" height="300"></canvas>
                        <canvas id="uptime-graph" width="800" height="200"></canvas>
                        <canvas id="doublebuff-graph" width="800" height="150"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="commitsBox" tabindex="-1" role="dialog" aria-labelledby="commitsTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="commitsTitle">Latest Updates - <a
                                href="https://github.com/dl-stuff/dl/commits/master">See all</a></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" id="changelog">
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="aclBox" tabindex="-1" role="dialog" aria-labelledby="aclTitle" aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="aclTitle">ACL Syntax</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li>Each consists of an action, optionally followed by a comma and condition, e.g.
                                <code>s1, x=5</code></li>
                            <li>Lines starting with # is considered comment and not evaluated</li>
                            <li>` is a decorator that is removed from each line, this behavior exists due to
                                historical
                                reasons.</li>
                            <li>During the simulation, the ACL is read from top to bottom. When the action is
                                available
                                (e.g. skill is filled) and any specified condition is met, the action is executed.
                                When
                                none of the specified actions are used, the sim will perform the next auto attack
                                (c1 c2
                                c3 c4 c5 then back to c1)</li>
                            <li>You can specify the same action multiple times, to cover different conditions.</li>
                            <li>It's also possible to specify blocks of actions+subconditions under one condition,
                                using
                                python-like if/elif/else syntax:<br />
                                <pre class="leftpad-code"><code>if &lt;condition&gt;
...
elif &lt;condition&gt;
...
else
...
end</code></pre>Unlike python, <code>end</code> is required and indentation does not matter.
                            </li>
                            <li>You can use <code>queue</code> to enforce a certain sequence of actions, for
                                example:
                                <pre class="leftpad-code"><code>queue
`s1
`s1
`s2
end</code></pre>This forces 2 s1 uses before an s2 use, even if s2 was fully charged before the second s1 is cast.<br>
                                Queue can be used with a condition like <code>queue &lt;condition&gt;</code> such
                                that
                                the actions in that block are only queued when the condition is true.
                            </li>
                            <li>The built in actions include skills (s1, s2, s3), force strike (fs), a dodge roll
                                (dodge), and shapeshift (dragon). Force strike fail (fsf) is an action too, but it
                                is
                                assumed to be performed for c5 hit of blade, wand, and lance.</li>
                            <li>Some adventurers have extra actions implemented, for example Ramona has s1a for
                                using
                                all hits on her s1.</li>
                            <li>The dragon action assumes you are doing the normal full duration optimal combo, but
                                you
                                can change that by using <code>dragon(act seq)</code>. The syntax is:
                            <li>Each action is separated by a hypen (-), e.g. <code>dragon(c3-s-c3-end)</code></li>
                            <li><code>cX</code> (e.g. <code>c3</code>) means do c1 to cX of the dragon combo chain.
                                Most
                                dragons go up to 3 combos, some have 5 combos.</li>
                            <li><code>s</code> means use skill (if they have usage left)</li>
                            <li><code>dodge</code> means do a dodge. Dodge is implicitly added after <code>cX</code>
                                if
                                dodge is faster than recovery or if the <code>cX</code> is not the final combo.</li>
                            <li><code>end</code> means preemptively stop the transform, used to represent dragon
                                tanking.</li>
                            <li>The conditions are essentially python code that is evaluated so they can be just
                                about
                                anything, but the most commonly used ones are:
                                <ul>
                                    <li><code>x=n</code> or <code>seq=n</code>: the previous action was combo #n in
                                        the
                                        attack chain.</li>
                                    <li><code>fsc</code>: the previous action was force strike</li>
                                    <li><code>cancel</code>: the previous action was a combo or a force strike,
                                        equivalent to <code>x=1 or x=2 or x=3 or x=4 or x=5 or fsc</code>.</li>
                                    <li><code>s=n</code>: the previous action was skill #n</li>
                                    <li><code>s</code>: the previous action was a skill</li>
                                    <li><code>prep</code>: at the start of the fight if the adventurer has skill
                                        prep</li>
                                    <li><code>s1.charged</code> is the amount of sp charged on s1, you can combine
                                        it
                                        with <code>s1.sp</code> and <code>this.sp_val</code> to make conditions like
                                        <code>s1.charged&gt;=s1.sp-this.sp_val('fs')</code>, aka "do this action
                                        when S1
                                        is one FS away from being fully charged. This can be used with s2 and s3 as
                                        well.</li>
                                    <li><code>s1.check()</code> signify that a skill is ready to use.</li>
                                    <li>``this.have_buff(buffname)` checks for presence of buff on certain
                                        character.
                                        The name of buffs is poorly documented with inconsistent naming scheme, but
                                        you
                                        can look at logs to figure out the specifics for your adventurer.</li>
                                    <li>You can use any python logical operators in the condition, such as
                                        <code>and</code> to combine 2 conditions</li>
                                    <li>For Agito weapons, <code>s3, not this.s3_buff</code> means only use S3 if
                                        the
                                        buff is not on, you can also check for what type of buff is currently
                                        active,
                                        e.g. <code>s3, this.s3_buff and this.s3_buff.mod_type = 'defense'</code>
                                    </li>
                                    <li>Special conditions are implemented for some adventurers but unfortunately
                                        most
                                        aren't well documented nor universal. You most likely have to look at the
                                        source
                                        code to tell.</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div id="qc-warning"></div>
    <div id="test-warning"></div>
    <div id="test-error"></div>
    <div id="test-results"></div>
    <div id="copy-results"></div>
</body>

</html>